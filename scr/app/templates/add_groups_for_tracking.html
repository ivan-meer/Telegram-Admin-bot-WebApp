{% extends "base.html" %}
{% block title %}üîç –î–æ–±–∞–≤–∏—Ç—å –≥—Ä—É–ø–ø—ã / –∫–∞–Ω–∞–ª—ã{% endblock %}
{% block content %}
</br>
<h3>üîç –î–æ–±–∞–≤–∏—Ç—å –≥—Ä—É–ø–ø—ã / –∫–∞–Ω–∞–ª—ã</h3>
<label for="save-username">–í–≤–µ–¥–∏—Ç–µ username –≥—Ä—É–ø–ø—ã / –∫–∞–Ω–∞–ª–∞, –Ω–∞–ø—Ä–∏–º–µ—Ä: @username:</label>
<textarea id="save-username" rows="4" placeholder="–ü—Ä–∏–º–µ—Ä: @username"></textarea>
<button onclick="saveUsername()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>

<script>
    async function saveUsername() {
        const inputField = document.getElementById("save-username");
        const save_username = inputField.value.trim();

        if (!save_username.startsWith("@")) {
            alert("Username –¥–æ–ª–∂–µ–Ω –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å @");
            return;
        }

        try {
            const formData = new FormData();
            formData.append("username_chat_channel", save_username);

            const response = await fetch("/save-username", {
                method: "POST",
                body: formData,
            });

            if (!response.ok) {
                throw new Error(`–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞: ${response.status}`);
            }

            const result = await response.json();

            if (result.success) {
                inputField.value = "";
                alert("–ì—Ä—É–ø–ø–∞ / –∫–∞–Ω–∞–ª —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∞!");
            } else {
                alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏: " + result.error);
            }
        } catch (error) {
            console.error("–û—à–∏–±–∫–∞:", error);
            alert("–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≥—Ä—É–ø–ø—É / –∫–∞–Ω–∞–ª.");
        }
    }
</script>

{% endblock %}